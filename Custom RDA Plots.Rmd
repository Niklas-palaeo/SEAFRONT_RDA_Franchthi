---
title: "Untitled"
author: "Niklas"
date: '2024-03-09'
output: html_document
---
# Info
This script works along the `RDA_Vegan.Rmd` or the `RDA_Short.Rmd` script and is only for customising the RDA Plot.


```{r}

# Define the dataset you want to analyse

Data <- All_RDA
# plot.new()

## extract % explained by the first 2 axes
perc <- round(100*(summary(Data)$cont$importance[2, 1:2]), 2)

## extract scores - these are coordinates in the RDA space
sc_si <- scores(Data, display="sites", choices=c(1,2), scaling=1)
sc_sp <- scores(Data, display="species", choices=c(1,2), scaling=1)
sc_bp <- scores(Data, display="bp", choices=c(1, 2), scaling=1)

## Custom triplot, step by step

# png("Faunal_Remains_RDA.png", width=100, height=220.51, res=300, units="cm", bg="white")


# Set up a blank plot with scaling, axes, and labels
plot(Data,
     scaling = 2, # set scaling type 
     type = "none", # this excludes the plotting of any points from the results
     frame = FALSE,
     # set axis limits
     xlim = c(-1,1), 
     ylim = c(-1,1),
     # label the plot (title, and axes)
     main = "Botanical Remains RDA",
     xlab = paste0("RDA1 (", perc[1], "%)"), 
     ylab = paste0("RDA2 (", perc[2], "%)") 
)
# add points for site scores
points(sc_si, 
       pch = 21, # set shape (here, circle with a fill colour)
       col = "white", # outline colour
       bg = "#223466ff", # fill colour
       cex = 1.2) # size
# add points for species scores
points(sc_sp, 
       pch = 22, # set shape (here, square with a fill colour)
       col = "black",
       bg = "#fdb21aff", 
       cex = 1.2)
# add text labels for species abbreviations
text(sc_sp + c(0.03, 0.09), # adjust text coordinates to avoid overlap with points 
     labels = rownames(sc_sp), 
     col = "grey40", 
     font = 2, # bold
     cex = 1)
# add arrows for effects of the expanatory variables
arrows(0,0, # start them from (0,0)
       sc_bp[,1]*2, sc_bp[,2]*2, # end them at the score value
       col = "#e84148ff", 
       lwd = 3)
# add text labels for arrows
text(x = sc_bp[,1] * 2.4, # adjust text coordinate to avoid overlap with arrow tip
     y = sc_bp[,2] * 2.4, 
     labels = rownames(sc_bp), 
     col = "#e84148ff", 
     cex = 2, 
     font = 2,
     adj = c(1, 0.5)) # Centered horizontally and vertically


# dev.off()


```

# ggplot
## FAUNA
### Showing sites by period
```{r}

# Assuming Data is an rda result, sc_si are site scores, sc_sp are species scores, and sc_bp are biplot scores

# scaling = 0: scaling for species scores (species-focused)
# scaling = 1: scaling for site scores (site-focused)
# scaling = 2: Hill's scaling (equalize the variance of scores)
scaling <-  0

# Extract scores
site_scores <- scores(Data, display="sites", choices=c(1,2), scaling=scaling)
species_scores <- scores(Data, display="species", choices=c(1,2), scaling=scaling)
biplot_scores <- scores(Data, display="bp", choices=c(1, 2), scaling=scaling)


# Combining and reshaping the data frames using tidyr for a more concise approach
df_sites <- data.frame(site_scores[, 1:2], Type = "Site", Labels = rownames(site_scores))
df_species <- data.frame(species_scores[, 1:2], Type = "Species", Labels = rownames(species_scores))
df_biplot <- data.frame(RDA1 = biplot_scores[, 1] * 2, RDA2 = biplot_scores[, 2] * 2, Type = "Biplot", Labels = rownames(biplot_scores))

# Use bind_rows from dplyr to combine, since tidyr is more about reshaping
df_combined <- dplyr::bind_rows(df_sites, df_species) %>%
  rename(RDA1 = 1, RDA2 = 2) %>% 
  left_join(D18O %>% rename(Labels=trenchunit) %>% select(Labels,chronology),by="Labels")# Ensure the column names are consistent

# Plotting
ggplot() +
  geom_blank(aes(x = RDA1, y = RDA2), data = df_combined) +
  geom_point(data = df_combined[df_combined$Type == "Site", ], aes(x = RDA1, y = RDA2,fill=chronology), shape = 21, color = "white", 
             #fill = "#223466ff", 
             size = 4) +
    scale_fill_manual(values = chron_colours) + 
  geom_point(data = df_combined[df_combined$Type == "Species", ], aes(x = RDA1, y = RDA2), shape = 22, color = "black", fill = "#fdb21aff", size = 4,alpha=0.2) +
  geom_text(data = df_combined[df_combined$Type == "Site", ], aes(x = RDA1, y = RDA2, label = Labels), hjust = 1.1, vjust = 1.1, color = "grey40", fontface = "bold", size = 3.5,alpha=0.2) +
  geom_segment(data = df_biplot, aes(x = 0, y = 0, xend = RDA1, yend = RDA2), arrow = arrow(type = "closed"), color = "#e84148ff", linewidth = 1) +
  geom_text(data = df_biplot, aes(x = RDA1, y = RDA2, label = rownames(df_biplot)), color = "#e84148ff", size = 6, fontface = "bold", hjust = 0.1, vjust = 1.91) +
  # scale_x_continuous(limits = c(-2, 2)) +
  # scale_y_continuous(limits = c(-1, 1)) +
  labs(x = paste0("RDA1 (", perc[1], "%)"), y = paste0("RDA2 (", perc[2], "%)"), title = "Faunal Remains RDA") +
  theme_cowplot()

```
### Showing species related to periods
```{r}

# Assuming Data is an rda result, sc_si are site scores, sc_sp are species scores, and sc_bp are biplot scores

# scaling = 0: scaling for species scores (species-focused)
# scaling = 1: scaling for site scores (site-focused)
# scaling = 2: Hill's scaling (equalize the variance of scores)
scaling <-  0

# Extract scores
site_scores <- scores(Data, display="sites", choices=c(1,2), scaling=scaling)
species_scores <- scores(Data, display="species", choices=c(1,2), scaling=scaling)
biplot_scores <- scores(Data, display="bp", choices=c(1, 2), scaling=scaling)


# Combining and reshaping the data frames using tidyr for a more concise approach
df_sites <- data.frame(site_scores[, 1:2], Type = "Site", Labels = rownames(site_scores))
df_species <- data.frame(species_scores[, 1:2], Type = "Species", Labels = rownames(species_scores))
df_biplot <- data.frame(RDA1 = biplot_scores[, 1] * 2, RDA2 = biplot_scores[, 2] * 2, Type = "Biplot", Labels = rownames(biplot_scores))

# Use bind_rows from dplyr to combine, since tidyr is more about reshaping
df_combined <- dplyr::bind_rows(df_sites, df_species) %>%
  rename(RDA1 = 1, RDA2 = 2) %>% 
  left_join(D18O %>% rename(Labels=trenchunit) %>% select(Labels,chronology),by="Labels")# Ensure the column names are consistent

# Plotting
ggplot() +
  geom_blank(aes(x = RDA1, y = RDA2), data = df_combined) +
  geom_point(data = df_combined[df_combined$Type == "Site", ], aes(x = RDA1, y = RDA2,fill=chronology), shape = 21, color = "white", 
             #fill = "#223466ff", 
             size = 4,alpha=0.2) +
    scale_fill_manual(values = chron_colours) + 
  geom_point(data = df_combined[df_combined$Type == "Species", ], aes(x = RDA1, y = RDA2), shape = 22, color = "black", fill = "#fdb21aff", size = 4,alpha=1) +
  geom_text(data = df_combined[df_combined$Type == "Species", ], aes(x = RDA1, y = RDA2, label = Labels), hjust = 1.1, vjust = 1.1, color = "grey40", fontface = "bold", size = 3.5,alpha=1) +
  geom_segment(data = df_biplot, aes(x = 0, y = 0, xend = RDA1, yend = RDA2), arrow = arrow(type = "closed"), color = "#e84148ff", linewidth = 1) +
  geom_text(data = df_biplot, aes(x = RDA1, y = RDA2, label = rownames(df_biplot)), color = "#e84148ff", size = 6, fontface = "bold", hjust = 0.1, vjust = 1.91) +
  # scale_x_continuous(limits = c(-2, 2)) +
  # scale_y_continuous(limits = c(-1, 1)) +
  labs(x = paste0("RDA1 (", perc[1], "%)"), y = paste0("RDA2 (", perc[2], "%)"), title = "Faunal Remains RDA") +
  theme_cowplot()

```

## Flora
### Showing sites by period
```{r}

# Assuming Data is an rda result, sc_si are site scores, sc_sp are species scores, and sc_bp are biplot scores

# scaling = 0: scaling for species scores (species-focused)
# scaling = 1: scaling for site scores (site-focused)
# scaling = 2: Hill's scaling (equalize the variance of scores)
scaling <-  0

# Extract scores
site_scores <- scores(Data, display="sites", choices=c(1,2), scaling=scaling)
species_scores <- scores(Data, display="species", choices=c(1,2), scaling=scaling)
biplot_scores <- scores(Data, display="bp", choices=c(1, 2), scaling=scaling)


# Combining and reshaping the data frames using tidyr for a more concise approach
df_sites <- data.frame(site_scores[, 1:2], Type = "Site", Labels = rownames(site_scores))
df_species <- data.frame(species_scores[, 1:2], Type = "Species", Labels = rownames(species_scores))
df_biplot <- data.frame(RDA1 = biplot_scores[, 1] * 2, RDA2 = biplot_scores[, 2] * 2, Type = "Biplot", Labels = rownames(biplot_scores))

# Use bind_rows from dplyr to combine, since tidyr is more about reshaping
df_combined <- dplyr::bind_rows(df_sites, df_species) %>%
  rename(RDA1 = 1, RDA2 = 2) %>% 
  left_join(D18O %>% rename(Labels=trenchunit) %>% select(Labels,chronology),by="Labels")# Ensure the column names are consistent

# Plotting
ggplot() +
  geom_blank(aes(x = RDA1, y = RDA2), data = df_combined) +
  geom_point(data = df_combined[df_combined$Type == "Site", ], aes(x = RDA1, y = RDA2,fill=chronology), shape = 21, color = "white", 
             #fill = "#223466ff", 
             size = 4) +
    scale_fill_manual(values = chron_colours) + 
  geom_point(data = df_combined[df_combined$Type == "Species", ], aes(x = RDA1, y = RDA2), shape = 22, color = "black", fill = "#fdb21aff", size = 4,alpha=0.2) +
  geom_text(data = df_combined[df_combined$Type == "Site", ], aes(x = RDA1, y = RDA2, label = Labels), hjust = 1.1, vjust = 1.1, color = "grey40", fontface = "bold", size = 3.5,alpha=0.2) +
  geom_segment(data = df_biplot, aes(x = 0, y = 0, xend = RDA1, yend = RDA2), arrow = arrow(type = "closed"), color = "#e84148ff", linewidth = 1) +
  geom_text(data = df_biplot, aes(x = RDA1, y = RDA2, label = rownames(df_biplot)), color = "#e84148ff", size = 6, fontface = "bold", hjust = 0.1, vjust = 1.91) +
  # scale_x_continuous(limits = c(-2, 2)) +
  # scale_y_continuous(limits = c(-1, 1)) +
  labs(x = paste0("RDA1 (", perc[1], "%)"), y = paste0("RDA2 (", perc[2], "%)"), title = "Botanical Remains RDA") +
  theme_cowplot()

```
### Showing species related to periods
```{r}

# Assuming Data is an rda result, sc_si are site scores, sc_sp are species scores, and sc_bp are biplot scores

# scaling = 0: scaling for species scores (species-focused)
# scaling = 1: scaling for site scores (site-focused)
# scaling = 2: Hill's scaling (equalize the variance of scores)
scaling <-  0

# Extract scores
site_scores <- scores(Data, display="sites", choices=c(1,2), scaling=scaling)
species_scores <- scores(Data, display="species", choices=c(1,2), scaling=scaling)
biplot_scores <- scores(Data, display="bp", choices=c(1, 2), scaling=scaling)


# Combining and reshaping the data frames using tidyr for a more concise approach
df_sites <- data.frame(site_scores[, 1:2], Type = "Site", Labels = rownames(site_scores))
df_species <- data.frame(species_scores[, 1:2], Type = "Species", Labels = rownames(species_scores))
df_biplot <- data.frame(RDA1 = biplot_scores[, 1] * 2, RDA2 = biplot_scores[, 2] * 2, Type = "Biplot", Labels = rownames(biplot_scores))

# Use bind_rows from dplyr to combine, since tidyr is more about reshaping
df_combined <- dplyr::bind_rows(df_sites, df_species) %>%
  rename(RDA1 = 1, RDA2 = 2) %>% 
  left_join(D18O %>% rename(Labels=trenchunit) %>% select(Labels,chronology),by="Labels")# Ensure the column names are consistent

# Plotting
ggplot() +
  geom_blank(aes(x = RDA1, y = RDA2), data = df_combined) +
  geom_point(data = df_combined[df_combined$Type == "Site", ], aes(x = RDA1, y = RDA2,fill=chronology), shape = 21, color = "white", 
             #fill = "#223466ff", 
             size = 4,alpha=0.2) +
    scale_fill_manual(values = chron_colours) + 
  geom_point(data = df_combined[df_combined$Type == "Species", ], aes(x = RDA1, y = RDA2), shape = 22, color = "black", fill = "#fdb21aff", size = 4,alpha=1) +
  geom_text(data = df_combined[df_combined$Type == "Species", ], aes(x = RDA1, y = RDA2, label = Labels), hjust = 1.1, vjust = 1.1, color = "grey40", fontface = "bold", size = 3.5,alpha=1) +
  geom_segment(data = df_biplot, aes(x = 0, y = 0, xend = RDA1, yend = RDA2), arrow = arrow(type = "closed"), color = "#e84148ff", linewidth = 1) +
  geom_text(data = df_biplot, aes(x = RDA1, y = RDA2, label = rownames(df_biplot)), color = "#e84148ff", size = 6, fontface = "bold", hjust = 0.1, vjust = 1.91) +
  # scale_x_continuous(limits = c(-2, 2)) +
  # scale_y_continuous(limits = c(-1, 1)) +
  labs(x = paste0("RDA1 (", perc[1], "%)"), y = paste0("RDA2 (", perc[2], "%)"), title = "Botanical Remains RDA") +
  theme_cowplot()

```
